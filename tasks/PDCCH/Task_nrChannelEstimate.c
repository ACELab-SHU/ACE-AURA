/**
 * ****************************************
 * @file        Task_nrChannelEstimate.c
 * @brief       channel estimation using LS
 * @author      yuanfeng
 * @date        2024.7.22
 * @copyright   ACE-Lab(Shanghai University)
 * ****************************************
 */

#include "data_type.h"
#include "riscv_printf.h"
#include "venus.h"

typedef short __v6144i16 __attribute__((ext_vector_type(6144)));
typedef char  __v12288i8 __attribute__((ext_vector_type(12288)));

#define LEFT_SHIFT  0
#define RIGHT_SHIFT 1
VENUS_INLINE __v6144i16 cyclic_shift_6144_16(__v6144i16 tgtvec, int shift_length, int shift_direction,
                                             int vectorLength) {
  __v6144i16 result;
  __v6144i16 tmp_index;
  vclaim(tmp_index);
  __v6144i16 tmp_1;
  vclaim(tmp_1);
  vbrdcst(tmp_1, vectorLength, MASKREAD_OFF, vectorLength);
  vrange(tmp_index, vectorLength);
  tmp_index = vsadd(tmp_index, shift_direction == LEFT_SHIFT ? shift_length : (vectorLength - shift_length),
                    MASKREAD_OFF, vectorLength);
  tmp_index = vrem(tmp_1, tmp_index, MASKREAD_OFF, vectorLength);
  vclaim(result);
  vshuffle(result, tmp_index, tgtvec, SHUFFLE_GATHER, vectorLength);
  // vshuffle(retvec, tmp_index, tgtvec, SHUFFLE_GATHER, vectorLength);
  return result;
}

VENUS_INLINE __v12288i8 cyclic_shift_12288_8(__v12288i8 tgtvec, int shift_length, int shift_direction,
                                             int vectorLength) {
  __v12288i8 result;
  __v6144i16 tmp_index;
  vclaim(tmp_index);
  __v6144i16 tmp_1;
  vclaim(tmp_1);
  vbrdcst(tmp_1, vectorLength, MASKREAD_OFF, vectorLength);
  vrange(tmp_index, vectorLength);
  tmp_index = vsadd(tmp_index, shift_direction == LEFT_SHIFT ? shift_length : (vectorLength - shift_length),
                    MASKREAD_OFF, vectorLength);
  tmp_index = vrem(tmp_1, tmp_index, MASKREAD_OFF, vectorLength);
  vclaim(result);
  vshuffle(result, tmp_index, tgtvec, SHUFFLE_GATHER, vectorLength);
  // vshuffle(retvec, tmp_index, tgtvec, SHUFFLE_GATHER, vectorLength);
  return result;
}

// char input_rxData_real[720] = {
//     47,  -62, -63, -66, -64, -63, -65, 46,  -65, 43,  47,  -64, -58, -63, 51,
//     56,  -56, -58, 58,  -51, 59,  55,  63, -44, -48, 65,  62,  -42, -42, 68,
//     67,  67,  -48, 64,  65,  -44, 62,  64,  -44, 62,  59,  61,  -43, 58, -51,
//     62, -50, -50, 56,  63,  -55, -46, 56,  -53, 51,  64,  58,  60,  52,  -58,
//     51,  -57, -60, 59,  -64, -65, 47,  -66, 54, -64, -66, 53,  -64, 41,  -55,
//     42,  -53, -51, -64, 57,  59,  59,  46,  -61, -47, -49, 50,  -46, -62, 62,
//     -61, 58, -49, 40,  56,  -72, -58, -58, 49,  -78, -60, -61, -77, 50,  -76,
//     -56, -73, -69, 58,  43,  62,  46,  -61, -41, 70, 53,  -36, -37, 56,  -36,
//     41,  75,  -56, 70,  48,  63,  -64, 61,  63,  -70, -50, -73, -53, -72, 57,
//     -49, 38, -49, -68, 64,  -62, 43,  44,  -41, 66,  67,  -43, 41,  -40, 62,
//     -66, -47, -69, -46, -52, 59,  -49, 58,  34,  -74, -76, 57,  -74, -72,
//     -69, 61,  40,  37,  -67, 39,  -41, -68, -42, 39,  61,  36,  37,  -47,
//     -47, -49, -52, -77, -53, -54, 24,  -81, 50,  -52, -84, -52, 28,  25, -81,
//     -49, -77, 56,  -48, -79, -47, -50, -51, 23,  -78, 54,  22, -50, -83, 23,
//     -80, -83, -53, -54, -50, -78, -81, 25,  -76, -42, -44, 30,  31,  34,  63,
//     30,  -77, -44, -80, 25, -47, -51, -54, -90, -54, -57, -93, -90, -92, -92,
//     -55, -88, 64,  41,  -65, 40,  40,  66,  -40, -41, -40, 37, -70, -41, 65,
//     -69, -40, -63, -69, -69, -71, 41,  -38, 38,  -42, 39,  36,  38,  38,  69,
//     -66, -66, -40, -37, 35,  39, -67, 66, -36, -68, 36,  -37, -67, -69, 34,
//     -69, -65, -39, 39,  -40, -1,  -1,  -1,  0,   0,   -1,  -1,  0,   72, 73,
//     74, 75,  74,  72,  74,  74,  76,  72,  -76, 73,  71,  72,  73,  75,  -75,
//     71,  70,  75,  -72, 73,  -75, 72, -76, 72, 73,  -75, -73, 71,  71,  73,
//     -71, -72, -73, 75,  -73, 73,  -76, 74,  73,  74,  73,  71,  70,  76, -72,
//     -72, 72, 70,  75,  -73, 73,  -71, -74, -72, -71, -74, -69, -73, -73, 70,
//     -74, 76,  49,  -73, 71,  67,  72,  72, -69, 72, -70, -70, 74,  -68, -73,
//     71,  -74, 70,  -73, -69, -71, -73, 67,  69,  -73, -72, -73, -75, 70,  69,
//     -69, -73, -70, -71, -70, 69,  69,  70,  -68, 72,  -74, 68,  69,  67,  72,
//     68,  -70, -73, 67,  67,  72,  -71, 68,  66, 66,  -71, 70,  67,  -70, -71,
//     -72, 67,  -70, -70, -71, -2,  -2,  0,   0,   -2,  -1,  0,   0,   -1,  22,
//     74, -74, 22,  -74, 23,  72,  24,  -21, -74, 19,  22,  -74, 19,  -21, -21,
//     72,  -75, 19,  -73, -73, -78, -21, -22, 19, -23, 76,  74, -75, -76, 76,
//     77,  77,  -74, -19, 77,  15,  19,  76,  74,  -17, -17, -19, 17,  -21,
//     -19, -17, 74,  -74, -74, -71, 72,  -72, 25,  23,  -74, 72,  22,  26, -74,
//     26,  72,  -73, 72,  -74, 23,  72,  71,  73,  74,  27,  24, 76,  72, -76,
//     75,  -74, -25, 74,  -73, -23, -22, 75,  -22, -73, 72,  77,  -22, 20, -21,
//     73,  77,  -23, 18,  75, -21, 71, 17,  -21, -19, -76, -75, -20, -19, -73,
//     -20, 18,  72,  -20, 74,  -20, 17,  74,  -17, 20,  17,  -76, -20, -74, 16,
//     17,  -77, -75, -77, 21,  73,  17,  -19, -16, 16,  -76, -15, -15, -16, 16,
//     -16, 77,  -19, -17, 13,  18, -19, 76, -78, 16,  78,  18,  72,  -75, -14,
//     -78, 77,  -16, 13,  14,  13,  73,  -14, 77,  -76, -77, -77, 13,  76, 74,
//     16, -18, 15,  -99, 76,  74,  11,  -15, 73,  -77, -11, 78,  -76, 9,   -79,
//     -12, 76,  -78, -10, -15, -78, -11, 9,   11, -12, 10,  7,   10,  -10, 8,
//     74,  -76, 80,  -12, 76,  75,  9,   76,  -80, -79, -80, -75, 77,  -79, 6,
//     -77, 75, 8,   -10, 11,  8,   8,   -7,  -75, 75,  79,  6,   6,   -80, 6,
//     -9,  5,   -10, 6,   -8,  78,  4,   5, 5,   -79, 79,  78,  3,   4,   -5,
//     -7,  76,  -80, 78,  75,  -79, -7,  2,   78,  -79, -80, 77,  -78, 3,   1,
//     2, 74,  -78, -78, 79,  78,  -1,  -1,  -3,  0,   1,   3,   1,   -79, 75,
//     -5,  78,  -1,  76,  2,   -5,  0,   1, -75, 79,  -3, -1,  0,   -78, 2, 73,
//     -76, -77};
// char input_rxData_imag[720] = {
//     -64, -62, -63, 50,  -58, -57, -54, -54, 52,  60,  58,  56,  -52, 58,  63,
//     -51, 55,  56,  -54, -56, -55, 52, -60, -69, 41,  -66, 43,  -71, -76, -71,
//     -72, -70, 33,  -69, -68, -74, -65, -65, -66, -59, 49,  52,  -63, 59,  52,
//     -48, 56,  57,  69,  -40, 63,  -46, 72,  64,  70,  -35, -34, -36, 72,  65,
//     70,  61,  59,  -38, 61,  61,  68,  59, -42, 56,  55,  -43, 54,  66,  -58,
//     61,  -57, -61, 50,  -50, -50, -49, 58,  43,  -69, -71, 51,  -73, 40, -61,
//     37, -60, -77, 51,  -61, 33,  -75, -74, -57, 40,  -68, -68, 44,  -49, 47,
//     -64, 45,  51,  -44, 65,  -44, 66,  46,  -61, -44, 59,  -63, -68, 62, -67,
//     40,  -53, 35,  -52, 54,  -49, 37,  -50, -47, 43,  -66, 45,  -64, 48, -39,
//     -64, 69, -65, 44,  -44, 40,  63,  56,  -76, -54, -52, -82, 52,  -81, -60,
//     29,  -81, 32,  -77, -74, -50, -71, -41, 68,  46, 46, -32, 54,  53,  52,
//     -26, 79,  80,  53,  74,  -57, 49,  -65, 68,  -41, 64,  63,  -76, -73,
//     -73, -75, 32,  -74, -79, 56,  30,  -44, -71, 36,  -72, 66,  62,  36, -67,
//     38,  -41, -67, 36,  -71, -68, -71, 62,  31,  -47, 61, -72, 32, 65,  37,
//     36,  -68, -67, -63, 42,  47,  74,  45,  -62, -62, 79,  76,  72,  -34, 72,
//     40,  -70, 34,  69,  -74, -73, -74, 32,  -72, -77, 29,  30,  28,  32, -72,
//     32,  -41, 64,  37,  63,  63,  -39, -66, -71, -69, 64,  40, -65, -39, 40,
//     -69, 40,  39,  39,  40,  65,  -64, 67,  -69, 63,  68,  65,  66,  -38, 38,
//     38,  -65, -68, 67,  65,  36, -36, -67, 39,  69,  -66, 34,  39,  67,  40,
//     35,  -66, 67,  -69, 2,   0,   1,   -1,  0,   -1,  -1,  -1,  22,  23, 22,
//     20,  21,  24,  23,  22,  23,  24,  -23, 23,  25,  23,  27,  22,  -25, 24,
//     28,  24,  -25, 24,  -25, 26,  -24, 27, 25,  -27, -28, 25,  26,  27,  -27,
//     -28, -27, 24,  -27, 28,  -24, 23,  26,  26,  26,  27,  27,  28,  -28,
//     -29, 27, 29,  25,  -25, 27,  -30, -28, -30, -30, -27, -30, -29, -27, 28,
//     -27, 28,  18,  -32, 27,  30,  29,  28,  -30, 28, -33, -32, 29,  -33, -30,
//     29,  -29, 31,  -31, -32, -33, -31, 33,  33,  -32, -32, -33, -32, 31,  34,
//     -33, -34, -34, -35, -34, 32,  34,  32,  -32, 29,  -33, 32,  31,  33,  33,
//     34,  -36, -33, 34,  36,  34,  -34, 33,  35,  34, -34, 33,  34,  -34, -36,
//     -35, 35,  -36, -37, -37, -1,  1,   -1,  0,   0,   -1,  -2,  -1,  0,   74,
//     -25, 24,  70, 23, 74,  -19, 75,  -75, 18,  75,  75,  20,  75,  -75, -72,
//     -20, 19,  71,  21,  21,  20,  -75, -73, 76,  -73, -22, -19, 17,  19, -19,
//     -18, -19, 21,  -78, -19, 74,  73,  -17, -17, -79, -78, -77, 74,  -74,
//     -75, -76, -17, 26,  23, 24, -26, 27,  71,  72,  22,  -25, 75,  70,  26,
//     75,  -28, 26,  -23, 25,  75,  -26, -24, -25, -22, 75,  74,  -21, -25, 23,
//     -23, 23,  -73, -25, 22,  -76, -73, -20, -73, 20,  -20, -24, -76, 74, -72,
//     -24, -23, -74, 74,  -23, -73, -25, 72,  -74, -74, 21,  20,  -78, -73, 21,
//     -74, 75,  -23, -73, -21, -73, 72,  -19, -76, 76,  76,  19, -76, 17,  74,
//     76,  18,  18,  16,  77,  -18, 71,  -77, -75, 79,  15,  -78, -76, -77, 75,
//     -77, -16, -76, -77, 75,  75, -76, -16, 15,  77,  -16, 76,  -18, 17,  -75,
//     15,  -17, -77, 74,  73,  76,  -17, -78, -13, 13,  15,  11,  73, -15, -17,
//     76, -75, 74,  3,   -10, -15, 78,  -75, -12, 15,  -78, -13, 10,  75,  9,
//     -76, -11, 14,  -77, -78, 14,  -79, 73,  75, -77, 77,  78,  80,  -80, 77,
//     -12, 11,  -10, -76, -11, -9,  76,  -12, 7,   7,   5,   8,   -10, 9,   74,
//     9,   -10, 79,  -78, 76,  76,  80,  -77, 6,   -8,  -7,  78,  78,  6,   77,
//     -75, 75,  -77, 76,  -77, -4,  75,  75, 73,  1, -5,  -5,  75,  74,  -77,
//     -75, -7,  5,   -5,  -6,  6,   -77, 76,  -4,  0,   4,   -3,  2,   73,  78,
//     76, -6,  1, 1,   -3,  -4,  76,  -79, -76, 78,  79,  77,  78,  4,   -3,
//     -77, -1,  -78, -1,  78,  -78, 80,  74,  4, -2,  79, -79, -77, 1,   76, 2,
//     -1,  -2};
// char input_dmrs_real[144] = {-91, 90,  90,  90,  90,  -91, 90,  90,  90, -91,
// -91, 90,  -91, -91, -91, -91, 90, -91,
//                              90,  90,  -91, 90,  90,  90,  90,  90,  90, -91,
//                              90,  90,  -91, -91, -91, 90,  -91, 90, -91, 90,
//                              90,  90,  90,  90,  90,  90,  -91, 90,  -91, 90,
//                              90,  90,  90,  -91, 90,  90, 90,  -91, 90,  90,
//                              90,  90,  90,  90,  -91, 90,  -91, -91, 90, -91,
//                              90,  -91, -91, -91, 90,  -91, -91, -91, 90, -91,
//                              90,  -91, 90,  90,  -91, -91, 90,  90,  -91,
//                              -91, 90, -91, -91, 90,  90,  90,  -91, 90,  -91,
//                              90,  90,  90,  -91, 90,  -91, -91, 90,  90, -91,
//                              -91, -91, 90,  90,  -91, 90,  -91, 90,  90, -91,
//                              90,  90,  -91, -91, 90,  -91, 90,  90, -91, -91,
//                              -91, -91, -91, -91, -91, 90,  -91, -91, 90, -91,
//                              -91, -91, 90,  90,  -91, -91, -91};
// char input_dmrs_imag[144] = {90,  90,  -91, 90,  -91, 90,  -91, 90,  -91, 90,
// -91, -91, -91, -91, 90, -91, -91, 90,
//                              -91, 90,  90,  90,  -91, 90,  90,  90,  -91, 90,
//                              -91, 90,  -91, -91, 90, 90,  -91, -91, 90,  90,
//                              -91, 90,  -91, -91, -91, 90,  -91, 90,  -91,
//                              -91, -91, 90,  90, -91, -91, 90, -91, -91, -91,
//                              90,  90,  -91, -91, 90,  -91, -91, 90,  -91, 90,
//                              90,  90, -91, 90,  90, 90,  90,  -91, 90,  -91,
//                              90,  90,  90,  -91, 90,  -91, -91, -91, -91, 90,
//                              -91, -91, 90, 90,  -91, 90,  -91, -91, 90,  90,
//                              -91, -91, 90,  90,  -91, -91, -91, 90, 90,  90,
//                              -91, -91, -91, 90,  90,  -91, 90,  -91, 90,  90,
//                              90,  90,  -91, -91, -91, 90, -91, -91, -91, -91,
//                              90,  -91, -91, -91, 90,  90,  90,  90,  -91, 90,
//                              90,  -91, -91, 90, -91, -91, -91};
// char input_rxData_real[720] = {
//     41,  -43, 44,  -44, -52, 41,  -44, -45, -47, -46, -48, -47, -53, 47, -43,
//     -45, -47, 43,  47,  43,  42,  43, -47, -42, -42, 45,  -47, -45, -38, 44,
//     46,  -46, -50, 45,  44,  41,  45,  40,  -43, 41,  45,  45,  -48, 41, -47,
//     -40, -44, -49, 41,  41,  -49, 48,  38,  41,  -44, -41, 42,  -43, -44,
//     -49, 34,  -50, 48,  48,  -46, 38,  -43, 44, 49, -46, -47, -51, -50, -46,
//     -43, -39, -43, 41,  -43, 48,  51,  -40, 45,  40,  -46, 48,  -43, 42, -44,
//     37,  -52, 44, -38, 37,  50,  48,  -43, 53,  52,  52,  -44, -50, 39,  38,
//     -50, -50, -41, -36, 43,  44,  52,  -51, -53, -52, 29, -54, -42, 50,  -41,
//     -52, 21,  41,  -60, 56,  41,  -58, -60, -59, 51,  -55, -61, -38, -42,
//     -57, 38,  58,  42, 55, 36,  34,  -49, -38, -40, -62, 57,  -57, 28,  -39,
//     -38, 57,  -39, -36, -51, 38,  -61, -55, -44, 59,  -40, -58, -63, -61,
//     -38, 37,  -59, -58, -60, -61, -59, 57,  -63, 55,  -40, 50,  -38, -36, 35,
//     -36, 29,  36,  -34, -64, 58, 27, 25,  -59, -35, 57,  -56, 61,  -63, -63,
//     -59, 57,  -60, 56,  -33, 33,  57,  -63, -31, -58, 35,  59,  27,  -56,
//     -39, 30,  -63, 58,  29,  -33, -30, 61,  -64, -56, -58, 60,  32,  58,  23,
//     60,  30,  60,  -63, -64, -64, 26, -28, 59, 23,  -62, -30, -29, 60,  25,
//     -58, -61, 25,  -34, 52,  33,  -54, -36, 35,  54,  -27, -50, -36, -50, 49,
//     -56, 52, 27,  -57, -33, -57, -56, -35, -58, -28, -34, 32,  -36, 33,  -35,
//     33,  -39, -48, 51,  32,  -59, 30,  -59, 35, 30, -34, -35, -38, 56,  -60,
//     31,  -31, 30,  -57, -49, 53,  -55, 0,   -1,  -1,  -3,  8,   -1,  -4,  -2,
//     63,  63, 61, 60,  53,  56,  63,  63,  61,  60,  -64, 61,  61,  61,  53,
//     57,  -62, 36,  61,  45,  -63, 51,  -64, 59,  -61, 46, 61,  -63, -54, 60,
//     59,  59,  -64, -63, -62, 58,  -54, 55,  -62, 61,  56,  60,  42,  61,  60,
//     59,  -53, -58, 60, 52,  60,  -63, 58,  -53, -62, -64, -62, -63, -63, -63,
//     -55, 60,  -63, 58,  56,  -64, 63,  58,  50,  51,  -64, 62, -63, -64, 57,
//     -64, -64, 60,  -64, 61,  -63, -60, -63, -63, 60,  50,  -62, -62, -63,
//     -63, 61,  60,  -54, -63, -62, -64, -64, 62,  59,  57,  -51, 54,  -64, 62,
//     58,  60,  59,  61,  -62, -62, 50,  55,  60,  -51, 58,  62,  61, -53, 60,
//     59,  -63, -62, -63, 61,  -54, -62, -60, 2,   -1,  0,   3,   -5,  -11,
//     -11, -2,  -1,  17,  63,  21,  62, -64, 16,  -59, 23,  -18, -47, -17, -49,
//     -64, -29, -23, 60,  63,  -49, -18, -64, -60, 62,  -64, 15,  18,  18,  16,
//     13, -59, 9,   15,  16,  62,  63,  -48, 13,  16,  12,  -14, -12, -18, 57,
//     63,  62,  -17, 19,  -15, -13, -53, 58, 54, 58,  -60, -26, 50,  59,  61,
//     22,  -56, -23, 19,  -24, 18,  -24, -63, 22,  -24, -24, 58,  -63, -17, 17,
//     56, -64, -64, -21, -64, -13, 61,  14,  -18, -21, 63,  -22, -60, -64, 10,
//     -22, 19,  20,  15,  19,  -20, 62,  18, -63, 58, 18,  60,  -64, -61, -63,
//     -59, -62, -58, 61,  -63, -62, -18, -29, 61,  -15, 57,  -19, 20,  -19,
//     -61, -16, 15, -17, 19,  62,  -11, -64, 19,  -63, -16, -21, -23, -16, 15,
//     -61, -18, -18, -61, -64, 58,  62,  61,  -15, 13,  49, 11, -64, 5,   62,
//     4,   47,  -63, 6,   23,  59,  -14, -15, 59,  -64, 62,  -64, 10,  -16,
//     -63, -13, 14,  58,  62, -64, -64, 62,  -64, -14, -14, -15, -15, 12,  -16,
//     -12, 63,  -64, -12, -64, -14, -64, -59, -64, -15, -11, -6,  63, 17, 62,
//     -64, -64, 19,  -64, -8,  -63, -64, 9,   7,   -64, 60,  -9,  63,  -12,
//     -64, -54, 63,  7,   -59, -9,  -61, -64, 2,   -15, -2,  61,  6,   63,  60,
//     -9,  60,  -64, 63,  -11, 2,   6,   63,  62,  6,   5,   61,  -7,  15,  -4,
//     -64, -9,  63,  3,   2,   62,  2,   -7,  -2,  -5,  63,  4,   63,  5,   63,
//     -64, 8,   -5,  -64, 63,  -64, -64, 60, -64, -7,  5,   61,  -1,  -6,  -4,
//     -7,  1,   -3,  -4,  -64, -12, 63,  -64, -6,  -1,  60,  -49, -7,  62,  -8,
//     63, 0, 0,   61,  62,  -4,  63,  -64, 63};
//
// char input_rxData_imag[720] = {
//     -48, 48,  45,  44,  -39, -48, 33,  -46, 43,  43,  44,  39,  -41, 39,  46,
//     48,  45,  -46, -41, 47,  -44, 47, -35, -50, 43,  -44, 46,  -41, -48, -43,
//     -44, 46,  41,  46,  -45, 48,  -40, 50,  32,  48,  44,  -42, 44,  48,  38,
//     -43, -46, 41,  49,  47,  -42, -42, 54,  49,  -38, -46, -42, -48, -48, 39,
//     46,  42,  -41, -41, 45,  50,  -47, -42, -36, -47, 29,  41,  40,  -45,
//     -48, -45, -44, -42, -47, -41, -40, -51, -37, 51,  -43, -41, -38, -43, 41,
//     52,  40, -43, -44, 52,  -40, -42, -47, -37, -38, -36, -46, 42,  40,  51,
//     41,  37,  -50, -54, -46, 45,  -37, 39,  38,  38, 58, 38,  -46, -40, -41,
//     32,  48,  57,  41,  -35, 44,  39,  40,  39,  -44, 40,  42,  -61, -53, 37,
//     35,  -41, 60, -42, 56,  57,  34,  -50, -58, 37,  -42, 40,  59,  -60, -53,
//     -40, -46, -53, 38,  60,  38,  36,  -49, -38, -61, 37, 30, 34,  -59, 55,
//     45,  33,  21,  35,  39,  -31, 35,  -31, -52, -40, -58, -60, 61,  -58, 55,
//     61,  -54, 36,  -23, 59, 58,  34,  -61, -43, 27,  -36, 35,  36,  35,  -33,
//     33,  -36, -56, 57,  -46, 35,  -59, 33,  62,  -36, 56,  25, -62, 58,  33,
//     -31, 56,  -64, -58, -32, 37,  25,  37,  -32, 60,  -28, 62,  -30, 61, -30,
//     33,  35,  30,  62, -58, -34, 47,  29,  -60, -64, -29, 56,  31,  38,  61,
//     -61, -33, 54,  33,  -53, 54,  -33, -57, 34,  -53, 29,  -34, 35, -38, 48,
//     32,  -52, 33,  34,  -56, 33,  -52, -55, 55,  -54, 57,  -57, 55,  -51, 35,
//     -29, 57,  33,  56,  30,  56, 57, -58, -56, -44, -26, 29,  50,  -58, 57,
//     32,  41,  -35, 29,  1,   0,   0,   1,   4,   1,   -1,  -1,  19,  19, 21,
//     24,  19,  23,  19,  19,  23,  19,  -16, 18,  19,  20,  12,  15,  -19, 18,
//     21,  20,  -18, 17,  -18, 18,  -21, 22, 22,  -20, -18, 21,  25,  20,  -20,
//     -22, -19, 26,  -24, 25,  -23, 22,  21,  22,  28,  23,  26,  23,  -31,
//     -25, 23, 36,  21,  -22, 28,  -23, -22, -19, -24, -23, -23, -24, -24, 27,
//     -23, 25,  17,  -30, 22,  25,  27,  26,  -30, 26, -30, -30, 27,  -30, -27,
//     29,  -15, 35,  -31, -18, -23, -28, 24,  32,  -30, -28, -29, -29, 31,  28,
//     -32, -29, -27, -31, -32, 29,  33,  27,  -32, 28,  -32, 29,  33,  31,  26,
//     30,  -32, -35, 24,  28,  32,  -34, 28,  31,  28, -40, 29,  25,  -35, -33,
//     -35, 32,  -38, -34, -32, -2,  0,   -1,  3,   -6,  -1,  -6,  0,   -1,  60,
//     -18, 60, -19, 18, 63,  9,   60,  -64, 6,   -64, 16,  18,  -60, -64, -16,
//     -17, 15,  -64, 16,  13,  -19, 13,  63,  63,  62,  62, 61, 16,  60,  63,
//     62,  -15, -14, 14,  63,  62,  62,  -59, -63, -64, -22, -14, -17, -64, 56,
//     -64, -63, 25,  -25, -18, -22, 19,  -59, -21, -22, -24, 61,  28,  -61, 58,
//     -60, 63,  -59, 15,  62,  -61, -55, -22, 22,  -60, 61, -19, 18, 19,  -61,
//     20,  -54, -21, 60,  -56, -63, -16, -62, 17,  15,  58,  -63, 62,  63,  61,
//     62,  -59, -18, 61,  19, -21, 63,  -18, 13,  19,  19,  21,  15,  17,  -18,
//     21,  22,  -60, -53, -18, -60, -11, -62, 57,  -63, 16,  -61, 52, -62, 63,
//     -15, -47, 18,  60,  16,  -63, -63, -60, -63, 62,  21,  -63, -48, 12,  21,
//     -14, -15, -16, -46, 62, -18, 63, 8,   62,  -13, 62,  -11, 16,  63,  57,
//     -15, -48, -63, -10, 13,  -7,  15,  64,  -61, 19,  -63, 64,  -15, -12, 10,
//     6,   -13, 3,   -64, -64, -64, -64, 50,  -64, -62, -26, 7,   -61, 13, -64,
//     9,   10,  9,   -64, -64, -64, -14, 62, -12, 8,   9,   61,  9,   -64, 8,
//     10,  62,  61,  8,   -12, -64, -9,  -64, 5,   4,   -10, 59,  4,   -64, 8,
//     10, 63,  -64, -61, -5,  63,  -10, -7,  -64, -8,  5,   -6,  -64, 62,  63,
//     -6,  -2,  63,  63,  -12, -64, 63,  -64, 3, -64, -2,  -56, 63,  0,   -62,
//     -64, 60,  -64, -8,  61,  7,   63,  -7,  3,   47,  -64, 5,   -2,  -2,  3,
//     -2, 2, -64, 62,  -5,  47,  63,  62,  62,  63,  -64, 47,  -1,  -60, 0, -4,
//     -60, 63,  4,   1,   63,  5,   -62, 3, 47, -64, 2,   -1,  62,  -1,  -1,
//     0};
//
// unsigned char input_dmrs_real[144] = {
//     166, 90,  90,  90,  90,  166, 90,  90,  90,  166, 166, 90,  166, 166,
//     166, 166, 90,  166, 90,  90,  166, 90,  90,  90,  90,  90,  90,  166, 90,
//     90,  166, 166, 166, 90,  166, 90,  166, 90,  90,  90,  90,  90, 90,  90,
//     166, 90,  166, 90,  90,  90,  90,  166, 90,  90,  90,  166, 90,  90,  90,
//     90,  90,  90,  166, 90,  166, 166, 90,  166, 90,  166, 166, 166, 90, 166,
//     166, 166, 90,  166, 90,  166, 90,  90,  166, 166, 90,  90,  166, 166, 90,
//     166, 166, 90,  90,  90,  166, 90,  166, 90,  90,  90,  166, 90,  166,
//     166, 90, 90,  166, 166, 166, 90,  90,  166, 90,  166, 90,  90,  166, 90,
//     90,  166, 166, 90,  166, 90,  90,  166, 166, 166, 166, 166, 166, 166, 90,
//     166, 166, 90,  166, 166, 166, 90,  90,  166, 166, 166};
//
// unsigned char input_dmrs_imag[144] = {
//     90,  90,  166, 90,  166, 90,  166, 90,  166, 90,  166, 166, 166, 166, 90,
//     166, 166, 90,  166, 90,  90, 90,  166, 90,  90,  90,  166, 90,  166, 90,
//     166, 166, 90,  90,  166, 166, 90,  90,  166, 90,  166, 166, 166, 90, 166,
//     90,  166, 166, 166, 90,  90,  166, 166, 90,  166, 166, 166, 90,  90, 166,
//     166, 90,  166, 166, 90,  166, 90,  90,  90,  166, 90,  90,  90,  90, 166,
//     90,  166, 90,  90,  90,  166, 90,  166, 166, 166, 166, 90,  166, 166, 90,
//     90,  166, 90,  166, 166, 90,  90,  166, 166, 90,  90,  166, 166, 166, 90,
//     90,  90,  166, 166, 166, 90,  90,  166, 90,  166, 90,  90,  90,  90, 166,
//     166, 166, 90,  166, 166, 166, 166, 90,  166, 166, 166, 90,  90,  90,  90,
//     166, 90,  90,  166, 166, 90,  166, 166, 166};
// short input_dmrs_index[144] = {
//     0,   4,   8,   12,  16,  20,  24,  28,  32,  36,  40,  44,  48,  52,  56,
//     60,  64,  68,  72,  76,  80, 84,  88,  92,  96,  100, 104, 108, 112, 116,
//     120, 124, 128, 132, 136, 140, 144, 148, 152, 156, 160, 164, 168, 172,
//     176, 180, 184, 188, 192, 196, 200, 204, 208, 212, 216, 220, 224, 228,
//     232, 236, 240, 244, 248, 252, 256, 260, 264, 268, 272, 276, 280, 284,
//     432, 436, 440, 444, 448, 452, 456, 460, 464, 468, 472, 476, 480, 484,
//     488, 492, 496, 500, 504, 508, 512, 516, 520, 524, 528, 532, 536, 540,
//     544, 548, 552, 556, 560, 564, 568, 572, 576, 580, 584, 588, 592, 596,
//     600, 604, 608, 612, 616, 620, 624, 628, 632, 636, 640, 644, 648, 652,
//     656, 660, 664, 668, 672, 676, 680, 684, 688, 692, 696, 700, 704, 708,
//     712, 716};

// char input_rxData_real[12 * 5] = {
//     1, 2,  3,  4,  5, 6,  7,  8,  9, 10, 11, 12, 1, 2,  3,  4,  5, 6,  7,  8,
//     9, 10, 11, 12, 1, 2,  3,  4,  5, 6,  7,  8,  9, 10, 11, 12, 1, 2,  3,  4,
//     5, 6,  7,  8,  9, 10, 11, 12, 1, 2,  3,  4,  5, 6,  7,  8,  9, 10, 11,
//     12};
// char input_rxData_imag[12 * 5] = {
//     1, 2,  3,  4,  5, 6,  7,  8,  9, 10, 11, 12, 1, 2,  3,  4,  5, 6,  7,  8,
//     9, 10, 11, 12, 1, 2,  3,  4,  5, 6,  7,  8,  9, 10, 11, 12, 1, 2,  3,  4,
//     5, 6,  7,  8,  9, 10, 11, 12, 1, 2,  3,  4,  5, 6,  7,  8,  9, 10, 11,
//     12};

// char input_dmrs_real[3 * 2] = {1, 1, 1, 1, 1, 1};
// char input_dmrs_imag[3 * 2] = {0};

// short input_dmrs_index[3 * 2] = {0, 4, 8, 12, 16, 20};

// char input_coef_h[4096] = {
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,
//     0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3};

// short dmrs_symbol_index[2] = {1, 3};

#define maxSegmentNumber 50
int segmentRange[maxSegmentNumber][2] = {0};

int Task_nrChannelEstimate(__v12288i8 rxData_real, __v12288i8 rxData_imag, __v12288i8 dmrs_real, __v12288i8 dmrs_imag,
                           __v6144i16 dmrs_index, __v12288i8 global_coef_h, __v6144i16 dmrs_symbol_index,
                           __v6144i16 rxData_shuffle_index, short_struct input_nrbLength,
                           short_struct input_data_symbol_length, short_struct input_dmrs_interval,
                           short_struct input_dmrs_ref_length, short_struct input_dmrs_symbol_length) {

  /* 输入接收数据，DMRS索引，DMRS参考信号，DMRS间隔，单个符号的DMRS长度，单个符号子载波长度，DMRS时域符号编号和时域符号长度,时域总符号长度。*/
  // short subcarrierLength   = 12;
  short subcarrierLength   = input_nrbLength.data * 12;
  short data_symbol_length = input_data_symbol_length.data;
  short dmrs_interval      = input_dmrs_interval.data;
  short dmrs_ref_length    = input_dmrs_ref_length.data;
  short dmrs_symbol_length = input_dmrs_symbol_length.data;
  dmrs_ref_length          = dmrs_ref_length / dmrs_symbol_length;

  int fractionLength = 7;

  // /*--------------------input rx data--------------------*/
  // __v12288i8 rxData_real;
  // __v12288i8 rxData_imag;
  // vclaim(rxData_real);
  // vbarrier();
  // VSPM_OPEN();
  // int rxData_real_addr = vaddr(rxData_real);
  // for (int i = 0; i < subcarrierLength * data_symbol_length; ++i) {
  //   *(volatile char *)(rxData_real_addr + i) = input_rxData_real[i];
  // }
  // VSPM_CLOSE();
  // vclaim(rxData_imag);
  // vbarrier();
  // VSPM_OPEN();
  // int rxData_imag_addr = vaddr(rxData_imag);
  // for (int i = 0; i < subcarrierLength * data_symbol_length; ++i) {
  //   *(volatile char *)(rxData_imag_addr + i) = input_rxData_imag[i];
  // }
  // VSPM_CLOSE();

  // /*--------------------input dmrs--------------------*/
  // __v12288i8 dmrs_real;
  // __v12288i8 dmrs_imag;
  // vclaim(dmrs_real);
  // vbarrier();
  // VSPM_OPEN();
  // int dmrs_real_addr = vaddr(dmrs_real);
  // for (int i = 0; i < (dmrs_ref_length * dmrs_symbol_length); ++i) {
  //   *(volatile char *)(dmrs_real_addr + i) = input_dmrs_real[i];
  // }
  // VSPM_CLOSE();
  // vclaim(dmrs_imag);
  // vbarrier();
  // VSPM_OPEN();
  // int dmrs_imag_addr = vaddr(dmrs_imag);
  // for (int i = 0; i < (dmrs_ref_length * dmrs_symbol_length); ++i) {
  //   *(volatile char *)(dmrs_imag_addr + i) = input_dmrs_imag[i];
  // }
  // VSPM_CLOSE();

  // /*--------------------input dmrs index--------------------*/
  // __v6144i16 dmrs_index;
  // vclaim(dmrs_index);
  // vbarrier();
  // VSPM_OPEN();
  // int dmrs_index_addr = vaddr(dmrs_index);
  // for (int i = 0; i < (dmrs_ref_length * dmrs_symbol_length); ++i) {
  //   *(volatile short *)(dmrs_index_addr + (i << 1)) = input_dmrs_index[i];
  // }
  // VSPM_CLOSE();

  vshuffle(rxData_real, rxData_shuffle_index, rxData_real, SHUFFLE_GATHER, subcarrierLength * data_symbol_length);
  vshuffle(rxData_imag, rxData_shuffle_index, rxData_imag, SHUFFLE_GATHER, subcarrierLength * data_symbol_length);

  __v6144i16 const_value;
  vclaim(const_value);
  vbrdcst(const_value, subcarrierLength, MASKREAD_OFF, (dmrs_ref_length * dmrs_symbol_length));
  dmrs_index = vrem(const_value, dmrs_index, MASKREAD_OFF, (dmrs_ref_length * dmrs_symbol_length));

  // /*--------------------input global coef--------------------*/
  // __v12288i8 global_coef_h;
  // vclaim(global_coef_h);
  // vbarrier();
  // VSPM_OPEN();
  // int global_coef_h_addr = vaddr(global_coef_h);
  // for (int i = 0; i < 4096; ++i) {
  //   *(volatile unsigned char *)(global_coef_h_addr + i) = input_coef_h[i];
  // }
  // VSPM_CLOSE();

  __v12288i8 const_value_8bit;
  vclaim(const_value_8bit);
  vbrdcst(const_value_8bit, dmrs_interval, MASKREAD_OFF, 4096);
  global_coef_h = vrem(const_value_8bit, global_coef_h, MASKREAD_OFF, 4096);

  /************************************ init output & temp parameters
   * ***********************************/
  __v12288i8 h_real;
  __v12288i8 h_imag;
  __v6144i16 global_data_shuffle_index;
  __v6144i16 global_ref_shuffle_index;
  vclaim(h_real);
  vclaim(h_imag);
  vbrdcst(h_real, 1, MASKREAD_OFF, subcarrierLength * data_symbol_length);
  vbrdcst(h_imag, 1, MASKREAD_OFF, subcarrierLength * data_symbol_length);
  vclaim(global_data_shuffle_index);
  vclaim(global_ref_shuffle_index);

  /************************ LS & Frequence Interpolate ************************/
  for (int i = 0; i < dmrs_symbol_length; ++i) {
    int dmrs_symbol_index_addr = vaddr(dmrs_symbol_index);
    vbarrier();
    VSPM_OPEN();
    int cur_symbol_index = *(volatile short *)(dmrs_symbol_index_addr + (i << 1));
    VSPM_CLOSE();

    vrange(global_data_shuffle_index, subcarrierLength);
    vrange(global_ref_shuffle_index, dmrs_ref_length);

    global_data_shuffle_index =
        vsadd(global_data_shuffle_index, cur_symbol_index * subcarrierLength, MASKREAD_OFF, subcarrierLength);
    global_ref_shuffle_index = vsadd(global_ref_shuffle_index, i * dmrs_ref_length, MASKREAD_OFF, dmrs_ref_length);

    /*--------------------split data & dmrs--------------------*/
    __v12288i8 symbol_rxData_real;
    __v12288i8 symbol_rxData_imag;
    vclaim(symbol_rxData_real);
    vclaim(symbol_rxData_imag);
    vshuffle(symbol_rxData_real, global_data_shuffle_index, rxData_real, SHUFFLE_GATHER, subcarrierLength);
    vshuffle(symbol_rxData_imag, global_data_shuffle_index, rxData_imag, SHUFFLE_GATHER, subcarrierLength);
    __v12288i8 symbol_dmrs_real;
    __v12288i8 symbol_dmrs_imag;
    vclaim(symbol_dmrs_real);
    vclaim(symbol_dmrs_imag);
    vshuffle(symbol_dmrs_real, global_ref_shuffle_index, dmrs_real, SHUFFLE_GATHER, dmrs_ref_length);
    vshuffle(symbol_dmrs_imag, global_ref_shuffle_index, dmrs_imag, SHUFFLE_GATHER, dmrs_ref_length);
    __v6144i16 symbol_dmrs_index;
    vclaim(symbol_dmrs_index);
    vshuffle(symbol_dmrs_index, global_ref_shuffle_index, dmrs_index, SHUFFLE_GATHER, dmrs_ref_length);

    /*--------------------obtain rx dmrs--------------------*/
    __v12288i8 rxDmrs_real;
    __v12288i8 rxDmrs_imag;
    vclaim(rxDmrs_real);
    vclaim(rxDmrs_imag);
    vshuffle(rxDmrs_real, symbol_dmrs_index, symbol_rxData_real, SHUFFLE_GATHER, dmrs_ref_length);
    vshuffle(rxDmrs_imag, symbol_dmrs_index, symbol_rxData_imag, SHUFFLE_GATHER, dmrs_ref_length);

    /*--------------------calculate segment number--------------------*/
    __v6144i16 diff_shuffle_index;
    __v6144i16 diff_data;
    vclaim(diff_shuffle_index);
    vclaim(diff_data);
    vrange(diff_shuffle_index, dmrs_ref_length - 1);
    diff_shuffle_index = vsadd(diff_shuffle_index, 1, MASKREAD_OFF, dmrs_ref_length - 1);
    vshuffle(diff_data, diff_shuffle_index, symbol_dmrs_index, SHUFFLE_GATHER, dmrs_ref_length - 1);
    diff_data = vssub(symbol_dmrs_index, diff_data, MASKREAD_OFF, dmrs_ref_length - 1);
    diff_data = vslt(diff_data, dmrs_interval, MASKREAD_OFF, MASKWRITE_OFF, dmrs_ref_length - 1);

    vbarrier();
    int segment_num    = 1;
    segmentRange[0][0] = 0;
    segmentRange[0][1] = dmrs_ref_length - 1;
    VSPM_OPEN();
    for (int j = 0; j < dmrs_ref_length - 1; ++j) {
      int diff_data_addr  = vaddr(diff_data);
      int diff_data_value = *(volatile short *)(diff_data_addr + (j << 1));
      if (diff_data_value == 1) {
        segmentRange[segment_num - 1][1] = j;
        segmentRange[segment_num++][0]   = j + 1;
      }
    }
    segmentRange[segment_num - 1][1] = dmrs_ref_length - 1;
    VSPM_CLOSE();

    /*--------------------LS estimate--------------------*/
    __v12288i8 temp_h_real_symbol;
    __v12288i8 temp_h_imag_symbol;
    __v12288i8 ac_temp_h_real;
    __v12288i8 bd_temp_h_real;
    __v12288i8 ad_temp_h_imag;
    __v12288i8 bc_temp_h_imag;
    __v12288i8 c2_temp_h;
    __v12288i8 d2_temp_h;
    __v12288i8 c2_add_d2_temp_h;
    // rxDmrs./input_dmrs
    vsetshamt(fractionLength);
    ac_temp_h_real = vmul(rxDmrs_real, symbol_dmrs_real, MASKREAD_OFF, dmrs_ref_length);
    bd_temp_h_real = vmul(rxDmrs_imag, symbol_dmrs_imag, MASKREAD_OFF, dmrs_ref_length);
    vsetshamt(0);
    temp_h_real_symbol = vsadd(ac_temp_h_real, bd_temp_h_real, MASKREAD_OFF, dmrs_ref_length);

    vsetshamt(fractionLength);
    ad_temp_h_imag = vmul(rxDmrs_real, symbol_dmrs_imag, MASKREAD_OFF, dmrs_ref_length);
    bc_temp_h_imag = vmul(rxDmrs_imag, symbol_dmrs_real, MASKREAD_OFF, dmrs_ref_length);
    vsetshamt(0);
    temp_h_imag_symbol = vssub(ad_temp_h_imag, bc_temp_h_imag, MASKREAD_OFF,
                               dmrs_ref_length); // bc_temp_h_imag-ad_temp_h_imag
    rxDmrs_real        = vadd(rxDmrs_real, 0, MASKREAD_OFF, dmrs_ref_length);
    symbol_dmrs_real   = vadd(symbol_dmrs_real, 0, MASKREAD_OFF, dmrs_ref_length);
    ac_temp_h_real     = vadd(ac_temp_h_real, 0, MASKREAD_OFF, dmrs_ref_length);
    // temp_h_imag_symbol =
    //     vadd(temp_h_imag_symbol, 0, MASKREAD_OFF, dmrs_ref_length);

    /*--------linear interpolation(for every segment)--------*/
    __v12288i8 h_real_symbol;
    __v12288i8 h_imag_symbol;
    vclaim(h_real_symbol);
    vclaim(h_imag_symbol);

    /*--------------------local variable--------------------*/
    __v12288i8 temp_h_real;
    __v12288i8 temp_h_imag;
    __v12288i8 base_h_real;
    __v12288i8 base_h_imag;
    __v12288i8 weight_h_real;
    __v12288i8 weight_h_imag;
    __v12288i8 coef_h;
    __v12288i8 temp_h_shift_real;
    __v12288i8 temp_h_shift_imag;
    __v12288i8 dmrs_interval_vec;
    __v12288i8 h_real_segment;
    __v12288i8 h_imag_segment;
    __v12288i8 h_real_segment_mul;
    __v12288i8 h_imag_segment_mul;
    __v6144i16 temp_h_shuffle_index;
    __v6144i16 dmrs_shuffle_index;
    __v6144i16 base_dmrs_shuffle_index;
    __v6144i16 weight_dmrs_shuffle_index;
    __v6144i16 segment_data_shuffle_index;
    __v6144i16 dmrs_interval_index_vec;
    vclaim(temp_h_real);
    vclaim(temp_h_imag);
    vclaim(base_h_real);
    vclaim(base_h_imag);
    vclaim(coef_h);
    vclaim(temp_h_shift_real);
    vclaim(temp_h_shift_imag);
    vclaim(dmrs_interval_vec);
    vclaim(temp_h_shuffle_index);
    vclaim(dmrs_shuffle_index);
    vclaim(segment_data_shuffle_index);
    vclaim(dmrs_interval_index_vec);

    __v6144i16 tmp_index;
    vclaim(tmp_index);
    __v6144i16 tmp_index_1;
    vclaim(tmp_index_1);
    int shift_length;
    int shift_direction;
    int vectorLength;
    for (int segment = 0; segment < segment_num; segment++) {
      int dmrs_ref_length_segment  = segmentRange[segment][1] - segmentRange[segment][0] + 1;
      int subcarrierLength_segment = dmrs_ref_length_segment * dmrs_interval;
      vrange(temp_h_shuffle_index, dmrs_ref_length);
      temp_h_shuffle_index = vsadd(temp_h_shuffle_index, segmentRange[segment][0], MASKREAD_OFF, dmrs_ref_length);
      vshuffle(temp_h_real, temp_h_shuffle_index, temp_h_real_symbol, SHUFFLE_GATHER, dmrs_ref_length);
      vshuffle(temp_h_imag, temp_h_shuffle_index, temp_h_imag_symbol, SHUFFLE_GATHER, dmrs_ref_length);

      // prepare weight
      shift_length    = 1;
      shift_direction = LEFT_SHIFT;
      vectorLength    = dmrs_ref_length_segment;
      vbrdcst(tmp_index_1, vectorLength, MASKREAD_OFF, vectorLength);
      vrange(tmp_index, vectorLength);
      tmp_index = vsadd(tmp_index, shift_direction == LEFT_SHIFT ? shift_length : (vectorLength - shift_length),
                        MASKREAD_OFF, vectorLength);
      tmp_index = vrem(tmp_index_1, tmp_index, MASKREAD_OFF, vectorLength);
      vshuffle(temp_h_shift_real, tmp_index, temp_h_real, SHUFFLE_GATHER, vectorLength);
      vshuffle(temp_h_shift_imag, tmp_index, temp_h_imag, SHUFFLE_GATHER, vectorLength);
      // temp_h_shift_real = cyclic_shift_4096_8(temp_h_real, 1, LEFT_SHIFT,
      // dmrs_ref_length_segment); temp_h_shift_imag =
      // cyclic_shift_4096_8(temp_h_imag, 1, LEFT_SHIFT,
      // dmrs_ref_length_segment);
      weight_h_real = vssub(temp_h_real, temp_h_shift_real, MASKREAD_OFF, dmrs_ref_length_segment);
      weight_h_imag = vssub(temp_h_imag, temp_h_shift_imag, MASKREAD_OFF, dmrs_ref_length_segment);
      vbrdcst(dmrs_interval_vec, dmrs_interval, MASKREAD_OFF,
              subcarrierLength_segment); // trick
      vbrdcst(dmrs_interval_index_vec, dmrs_interval, MASKREAD_OFF,
              subcarrierLength_segment); // trick
      weight_h_real = vdiv(dmrs_interval_vec, weight_h_real, MASKREAD_OFF, dmrs_ref_length_segment);
      weight_h_imag = vdiv(dmrs_interval_vec, weight_h_imag, MASKREAD_OFF, dmrs_ref_length_segment);

      // obtian parameter
      vrange(dmrs_shuffle_index, subcarrierLength_segment);
      base_dmrs_shuffle_index =
          vdiv(dmrs_interval_index_vec, dmrs_shuffle_index, MASKREAD_OFF, subcarrierLength_segment);
      weight_dmrs_shuffle_index =
          vdiv(dmrs_interval_index_vec, dmrs_shuffle_index, MASKREAD_OFF, subcarrierLength_segment);
      vbrdcst(coef_h, 0, MASKREAD_OFF, subcarrierLength_segment);
      coef_h = vsadd(coef_h, global_coef_h, MASKREAD_OFF, subcarrierLength_segment);
      // base_h和coef_h前几个位置特殊处理 weight_h前几个和后几个位置特殊处理
      short start_index = 0, left_index = 0, right_index = 0;
      int   dmrs_index_addr = vaddr(symbol_dmrs_index);
      vbarrier();
      VSPM_OPEN();
      left_index = *(volatile short *)(dmrs_index_addr + (segmentRange[segment][0] << 1));
      VSPM_CLOSE();
      dmrs_index_addr = vaddr(symbol_dmrs_index);
      vbarrier();
      VSPM_OPEN();
      right_index = *(volatile short *)(dmrs_index_addr + (segmentRange[segment][1] << 1));
      VSPM_CLOSE();
      start_index = left_index / dmrs_interval * dmrs_interval;
      left_index -= start_index;
      right_index -= start_index;

      shift_length    = left_index;
      shift_direction = RIGHT_SHIFT;
      vectorLength    = subcarrierLength_segment;
      vbrdcst(tmp_index_1, vectorLength, MASKREAD_OFF, vectorLength);
      vrange(tmp_index, vectorLength);
      tmp_index = vsadd(tmp_index, shift_direction == LEFT_SHIFT ? shift_length : (vectorLength - shift_length),
                        MASKREAD_OFF, vectorLength);
      tmp_index = vrem(tmp_index_1, tmp_index, MASKREAD_OFF, vectorLength);
      vshuffle(base_dmrs_shuffle_index, tmp_index, base_dmrs_shuffle_index, SHUFFLE_GATHER, vectorLength);
      vshuffle(weight_dmrs_shuffle_index, tmp_index, weight_dmrs_shuffle_index, SHUFFLE_GATHER, vectorLength);
      // base_dmrs_shuffle_index =
      //     cyclic_shift_2048_16(base_dmrs_shuffle_index, left_index,
      //     RIGHT_SHIFT, subcarrierLength_segment);
      // weight_dmrs_shuffle_index =
      //     cyclic_shift_2048_16(weight_dmrs_shuffle_index, left_index,
      //     RIGHT_SHIFT, subcarrierLength_segment);
      shift_length    = left_index;
      shift_direction = RIGHT_SHIFT;
      vectorLength    = subcarrierLength_segment;
      vbrdcst(tmp_index_1, vectorLength, MASKREAD_OFF, vectorLength);
      vrange(tmp_index, vectorLength);
      tmp_index = vsadd(tmp_index, shift_direction == LEFT_SHIFT ? shift_length : (vectorLength - shift_length),
                        MASKREAD_OFF, vectorLength);
      tmp_index = vrem(tmp_index_1, tmp_index, MASKREAD_OFF, vectorLength);
      // vclaim(coef_h);
      vshuffle(coef_h, tmp_index, coef_h, SHUFFLE_GATHER, vectorLength);
      //  coef_h =
      // vsadd(coef_h, 0, MASKREAD_OFF, vectorLength);
      // coef_h = cyclic_shift_4096_8(coef_h, left_index, RIGHT_SHIFT,
      // subcarrierLength_segment);
      vbarrier();
      VSPM_OPEN();
      int base_dmrs_shuffle_index_addr = vaddr(base_dmrs_shuffle_index);
      for (int j = 0; j < left_index; ++j) {
        *(volatile short *)(base_dmrs_shuffle_index_addr + (j << 1)) = 0;
      }
      VSPM_CLOSE();

      vbarrier();
      VSPM_OPEN();
      int weight_dmrs_shuffle_index_addr = vaddr(weight_dmrs_shuffle_index);
      for (int j = 0; j < left_index; ++j) {
        *(volatile short *)(weight_dmrs_shuffle_index_addr + (j << 1)) = 0;
      }
      VSPM_CLOSE();

      vbarrier();
      VSPM_OPEN();
      int coef_h_addr = vaddr(coef_h);
      for (int j = 0; j < left_index; ++j) {
        *(volatile char *)(coef_h_addr + j) = -(left_index - j);
      }
      VSPM_CLOSE();

      vbarrier();
      VSPM_OPEN();
      weight_dmrs_shuffle_index_addr = vaddr(weight_dmrs_shuffle_index);
      for (int j = right_index; j < subcarrierLength_segment; ++j) {
        *(volatile short *)(weight_dmrs_shuffle_index_addr + (j << 1)) = dmrs_ref_length_segment - 1 - 1;
      }
      VSPM_CLOSE();
      // vclaim(coef_h);
      vshuffle(base_h_real, base_dmrs_shuffle_index, temp_h_real, SHUFFLE_GATHER, subcarrierLength_segment);
      vshuffle(base_h_imag, base_dmrs_shuffle_index, temp_h_imag, SHUFFLE_GATHER, subcarrierLength_segment);
      vshuffle(weight_h_real, weight_dmrs_shuffle_index, weight_h_real, SHUFFLE_GATHER, subcarrierLength_segment);
      vshuffle(weight_h_imag, weight_dmrs_shuffle_index, weight_h_imag, SHUFFLE_GATHER, subcarrierLength_segment);
      vclaim(base_h_real);
      vclaim(base_h_imag);
      // weight_h_real =
      //     vsadd(weight_h_real, 0, MASKREAD_OFF, subcarrierLength_segment);
      // coef_h = vsadd(coef_h, 0, MASKREAD_OFF, subcarrierLength_segment);
      // base_h_real =
      //     vsadd(base_h_real, 0, MASKREAD_OFF, subcarrierLength_segment);
      h_real_segment_mul = vmul(weight_h_real, coef_h, MASKREAD_OFF, subcarrierLength_segment);
      h_imag_segment_mul = vmul(weight_h_imag, coef_h, MASKREAD_OFF, subcarrierLength_segment);
      h_real_segment     = vsadd(h_real_segment_mul, base_h_real, MASKREAD_OFF, subcarrierLength_segment);
      h_imag_segment     = vsadd(h_imag_segment_mul, base_h_imag, MASKREAD_OFF, subcarrierLength_segment);
      // h_imag_segment = vmuladd(weight_h_imag, coef_h, base_h_imag,
      // MASKREAD_OFF,
      //                          subcarrierLength_segment);
      // VENUS_PRINTVEC_CHAR(base_h_real, subcarrierLength_segment);
      // asm("ebreak");

      vrange(segment_data_shuffle_index, subcarrierLength_segment);
      segment_data_shuffle_index =
          vsadd(segment_data_shuffle_index, start_index, MASKREAD_OFF, subcarrierLength_segment);

      vshuffle(h_real_symbol, segment_data_shuffle_index, h_real_segment, SHUFFLE_SCATTER, subcarrierLength_segment);
      vshuffle(h_imag_symbol, segment_data_shuffle_index, h_imag_segment, SHUFFLE_SCATTER, subcarrierLength_segment);
    }

    vshuffle(h_real, global_data_shuffle_index, h_real_symbol, SHUFFLE_SCATTER, subcarrierLength);
    vshuffle(h_imag, global_data_shuffle_index, h_imag_symbol, SHUFFLE_SCATTER, subcarrierLength);
  }

  vreturn(h_real, sizeof(h_real), h_imag, sizeof(h_imag));
}